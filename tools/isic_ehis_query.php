<?php
set_time_limit(0);
require_once('../class/config.php');
require_once(SITE_PATH . "/class/common.php");

$old_error_handler = set_error_handler("userErrorHandler");
hokusPokus();

require_once(SITE_PATH . "/class/".DB_TYPE.".class.php");
require_once(SITE_PATH . "/class/language.class.php");
require_once(SITE_PATH . "/class/text.class.php");
require_once(SITE_PATH . "/class/templatef.class.php");
require_once(SITE_PATH . "/class/Database.php");

require_once(SITE_PATH . '/class/Ehis/EhisUser.php');

$db = new DB();
$db->connect();
$sq = new sql;

$sq->con = $db->con;
$database = new Database($sq);
load_site_settings($database);
$data = $data_settings = $GLOBALS['site_settings'];

// init language object
$lan = new Language($database, '');
$language = $lan->lan();
$GLOBALS["language"] = &$language;
$ehisUser = new EhisUser();

echo "<pre>\n";

$personNumberList = array(
    '39209113522',
    '39403103513',
    '50306265235',
    '39510306029',
    '39411033511',
    '49410303515',
    '50407082711',
    '50112293512',
    '60001273510',
    '49511143517',
    '49612263523',
    '50305102725',
    '49609113513',
    '49503053513',
    '39912053512',
    '49605223517',
    '49707022742',
    '39406203523',
    '39801153539',
    '49606253521',
    '49710033516',
    '49704093522',
    '39505033519',
    '39906182721',
    '49611173519',
    '49604293517',
    '49608146814',
    '49812302747',
    '39601253517',
    '39404183519',
    '39801156813',
    '49601233526',
    '39603113515',
    '60001213511',
    '49609032764',
    '49310163514',
    '49405133545',
    '39806143513',
    '49401173518',
    '39901303519',
    '39312253517',
    '39401154927',
    '39709093521',
    '50208032719',
    '49705083517',
    '49508113516',
    '49508034924',
    '39903264910',
    '49404263512',
    '49605223528',
    '49407033516',
    '49605033512',
    '39905302727',
    '60011232717',
    '49605213510',
    '60108283510',
    '39609302760',
    '60409242728',
    '49202133524',
    '39607310235',
    '49308073513',
    '49511153524',
    '49611153516',
    '39803123517',
    '50405304712',
    '49908252747',
    '39807143551',
    '39807113519',
    '39404093513',
    '49412053516',
    '39812073512',
    '50002063538',
    '50311295213',
    '50009083532',
    '49607133539',
    '49603153533',
    '60103233516',
    '39712223519',
    '49302187016',
    '49604033531',
    '49408282026',
    '39402123511',
    '49511133510',
    '49604023511',
    '49604052742',
    '50302212734',
    '50402192732',
    '39309132727',
    '39509103513',
    '50105103512',
    '39501243518',
    '39609073526',
    '49503013529',
    '39702123514',
    '49901053526',
    '39408290256',
    '39508293511',
    '49505032719',
    '49604137011',
    '49510263510',
    '49304193524',
    '49606013514',
    '39501063520',
    '39708032739',
    '39502223512',
    '50103243511',
    '49603153511',
    '49712070225',
    '49805293517',
    '60202163518',
    '60102137014',
    '49606133512',
    '49404063511',
    '49605233513',
    '49503073516',
    '50503294914',
    '49506283517',
    '49408273517',
    '39411263511',
    '39508153510',
    '60105262735',
    '49709152743',
    '49805053510',
    '39503132714',
    '49501233512',
    '49506083516',
    '49506063513',
    '39602252721',
    '39712243533',
    '39404283514',
    '49404153510',
    '50012273517',
    '49606043513',
    '39312153511',
    '39311033529',
    '60109253527',
    '49612013512',
    '39506113516',
    '49911103534',
    '50504304917',
    '49504110908',
    '49504110919',
    '49707172736',
    '49508143515',
    '49605203514',
    '39404253515',
    '49510283513',
    '50203203524',
    '39603023516',
    '49807253521',
    '49403032728',
    '50307102713',
    '49511243512',
    '50307092792',
    '39911023519',
    '49504193519',
    '49505193513',
    '39701223521',
    '49501072716',
    '39502153513',
    '49503273517',
    '39807273512',
    '50103193518',
    '50209012710',
    '50310212717',
    '49908153534',
    '49608223510',
    '49806093521',
    '50309235218',
    '39704262730',
    '49501312777',
    '39710162725',
    '49401313512',
    '49603153522',
    '39908283516',
    '39710133510',
    '49802183511',
    '39909263518',
    '39406033510',
    '49303243512',
    '49502273512',
    '39809143528',
    '49509053510',
    '39404093520',
    '39803053510',
    '49412023510',
    '49807193521',
    '49606213515',
    '49801233510',
    '60104252723',
    '49503103517',
    '49603272722',
    '49408213519',
    '49810162712',
    '39310086017',
    '49612073529',
    '50102203511',
    '49512303517',
    '39504093512',
    '49311303517',
    '39301153513',
    '39507102746',
    '60010193527',
    '39409042775',
    '60507312728',
    '39406153519',
    '39604013514',
    '49506013511',
    '39306303515',
    '49407283524',
    '60212172744',
    '49401032736',
    '39501172710',
    '49103055713',
    '39503273516',
    '49401093517',
    '49404253516',
    '49705162730',
    '49912112756',
    '50211242735',
    '39901112713',
    '49504212723',
    '39901283525',
    '49604173519',
    '60006013524',
    '60005233512',
    '60203023511',
    '49701022720',
    '49909173520',
    '39210186042',
    '49407303513',
    '39702043517',
    '39402072739',
    '39503155238',
    '39606013524',
    '49408113513',
    '50103163521',
    '49802215223',
    '49410103525',
    '39404043518',
    '39611072711',
    '39501233511',
    '49803130011',
    '49310213513',
    '49512273516',
    '60112142715',
    '49412123516',
    '39408233510',
    '50209172779',
    '39706263519',
    '39905283512',
    '49807123516',
    '39606062747',
    '39207053512',
    '39512133514',
    '49603123512',
    '60001273510',
    '50104273515',
    '60309182769',
    '49806212719',
    '39802233514',
    '39506243510',
    '39809193519',
    '39811083514',
    '50408112761',
    '60212232761',
    '39810062727',
    '60211082746',
    '49906246819',
    '50204223516',
    '60007213519',
    '49603013521',
    '50310242738',
    '49807143563',
    '49402032723',
    '50002092725',
    '49907282809',
    '49710203518',
    '60008223520',
    '49306143510',
    '49701130859',
    '39608033526',
    '49910103529',
    '39801216018',
    '50203283520',
    '60311134921',
    '50102092728',
    '39601120815',
    '49902183514',
    '39907262729',
    '39902132710',
    '39507263518',
    '50409082743',
    '49604223523',
    '39408103516',
    '60110095213',
    '49209103516',
    '49701223544',
    '50005303529',
    '49402103517',
    '49406033511',
    '50206065710',
    '49712123514',
    '39409072741',
    '49512226821',
    '39703273511',
    '50202022726',
    '49505032719',
    '49603183510',
    '49509203513',
    '39604303514',
    '49910141519',
    '50004192720',
    '49606183514',
    '50207222806',
    '49704163526',
    '49904053519',
    '49706223536',
    '60309262761',
    '39508183512',
    '39712132723',
    '39411263511',
    '39405253511',
    '60001253528',
    '60008025714',
    '39512075726',
    '39806093542',
    '50005223515',
    '50209112727',
    '60401032735',
    '49311173510',
    '39401023522',
    '60006283530',
    '39505112743',
    '49404263534',
    '39909173519',
    '39512072724',
    '60311214924',
    '50105023528',
    '39807063515',
    '60005144924',
    '60106263519',
    '49501072716',
    '50004252719',
    '39612173512',
    '50007163525',
    '50301162725',
    '49604213516',
    '39506153511',
    '39705303511',
    '49604273514',
    '39511023529',
    '49404122013',
    '39905013517',
    '39706083510',
    '49812113521',
    '49311043516',
    '49211133512',
    '39807103534',
    '39703113529',
    '49802233526',
    '39801073514',
    '39502193519',
    '49407283524',
    '49401032736',
    '39907052743',
    '49401113522',
    '60009093518',
    '39711282766',
    '39403116827',
    '39901112713',
    '49604173530',
    '39701013513',
    '60005162225',
    '39503043516',
    '39808283513',
    '60009293519',
    '49811303510',
    '39303303522',
    '39412274248',
    '50002023510',
    '50110143516',
    '60207182712',
    '39405093547',
    '50001123522',
    '39612223527',
    '39504063513',
    '49404093510',
    '50103263514',
    '49206033527',
    '50112103519',
    '39510033519',
    '39607173511',
    '49506083516',
    '39404253515',
    '49407123515',
    '35507242717',
    '46703092795',
    '46410052747',
    '47607302774',
    '47907176519',
    '44810212739',
    '46612302713',
    '47710062743',
    '48703242776',
    '48602042734',
    '36501020016',
    '44409162715',
    '45802072722',
    '46512312740',
    '45301012748',
    '46504052755',
    '36208212771',
    '45810092725',
    '45512252759',
    '45909042772',
    '46002245214',
    '45710212738',
    '45809262762',
    '45202252768',
    '45704272729',
    '45307022741',
    '47101312807',
);
$personStatusList = array();

foreach ($personNumberList as $personNumber) {
    echo 'Query: ' . $personNumber . "\n";
    $ehisUser->getStatusListByUser($personNumber);
    $res = $ehisUser->getParsedResults();

    foreach ($res as $status) {
        foreach ($status['study_general'] as $studyStatus) {
            $personStatusList[] = array_merge($status['person'], $studyStatus);
        }
    }
}

$titles = array(
    'user_code',
    'name_first',
    'name_last',
    'birthday',
    'school_name',
    'school_ehis_code',
    'school_regno',
    'school_id',
    'status_id',
    'group_id',
    'class',
    'ok_code',
    'ok_name',
    'study_type',
    'load',
    'course'
);

echo implode('|', $titles) . "\n";

foreach ($personStatusList as $personStatus) {
    echo implode('|', $personStatus) . "\n";
}

echo "done\n";
echo "</pre>\n";